## 开发计划（MVP）
面向：三人掀棋、账号密码登录、房间与对局、实时状态与结算（不含额外规则/观战/四人/抱头/超时）。

## 标注说明
- 关注维度：架构 / 接口 / 实现 / 测试。
- 范围维度：前端 / 后端 / 逻辑引擎。
- 逻辑引擎独立性原则：核心规则与状态机不依赖 Web 框架与数据库；通过明确输入/输出结构与接口与后端集成。
- 流程约束：每一段实现完成后必须先做测试/验证，通过后再进入下一段实现。

## 里程碑与任务拆解
### M0 架构与接口设计（先行）
目标：先完成所有架构与接口设计，再进入任何实现。
- 总体分层与依赖方向（前端/后端/逻辑引擎/数据库）。[架构/全局]
- 数据模型草图与实体关系（仅 users 持久化；房间/对局/事件/快照为内存态）。[架构/后端][架构/逻辑引擎]
- 状态机定义（房间状态、对局阶段、回合/出牌流程）。[架构/逻辑引擎]
- 引擎输入/输出接口（动作类型、状态结构、事件结构）。[接口/逻辑引擎]
- 后端接口设计（Auth/Rooms/Game Actions/Settlement/重连）。[接口/后端]
- WebSocket 事件协议与订阅范围（房间列表、房间内状态、对局事件）。[接口/后端]
- 前端数据契约（页面所需字段、公共/私有状态划分）。[接口/前端]
- 更新 `memory-bank/architecture.md`：写入完整架构与接口设计稿。[架构/全局][接口/全局]

### M1 后端基础与账号系统
- 实现：FastAPI 项目结构、配置、CORS、日志、SQLite 初始化与迁移策略（仅 users）。[实现/后端]
- 实现：用户表与认证逻辑（注册/登录/鉴权）。[实现/后端]
- 测试/验证：注册/登录/鉴权 API 流程通过。[测试/后端]

### M2 房间与大厅
- 实现：房间/成员内存模型、就绪逻辑、房间状态流转（服务端重启清空）。[实现/后端]
- 实现：房间列表与房间内事件推送（WebSocket）。[实现/后端]
- 测试/验证：创建/加入/退出/就绪/列表刷新流程通过。[测试/后端]

### M3 对局引擎（核心规则）
- 实现：牌堆构建、发牌、回合与出牌/垫棋/扣棋/掀棋逻辑。[实现/逻辑引擎]
- 实现：压制规则与大小比较、轮次归属与柱数统计。[实现/逻辑引擎]
- 实现：引擎与后端数据结构映射适配层。[实现/逻辑引擎][实现/后端]
- 测试/验证：核心规则单元测试通过（比较、垫棋、掀/扣流程）。[测试/逻辑引擎]

### M4 结算与筹码
- 实现：够/瓷判定、掀棋筹码、扣棋筹码与基础输赢结算。[实现/逻辑引擎]
- 实现：结算结果输出结构与后端状态更新（局内有效，不持久化）。[实现/逻辑引擎][实现/后端]
- 测试/验证：结算边界用例通过（够/瓷/掀棋关系）。[测试/逻辑引擎]

### M5 实时状态与断线重连
- 实现：内存事件流与公共/私有状态聚合（可选 ring-buffer 仅调试）。[实现/后端]
- 实现：WebSocket 推送对局事件与状态变更。[实现/后端]
- 测试/验证：事件顺序正确、重连后可恢复全量状态（服务端未重启）。[测试/后端]

### M6 前端 MVP
- 实现：登录页、大厅、房间、对局、结算弹窗。[实现/前端]
- 实现：WebSocket 连接与状态同步策略。[实现/前端]
- 测试/验证：三人完整流程 UI 走通，关键交互无阻塞。[测试/前端]

### M7 全链路验收
- 验收脚本：三人完整局从登录到结算的全链路验证。[测试/前端][测试/后端][测试/逻辑引擎]
- 回归清单：核心规则、状态机与结算逻辑回归。[测试/全局]

## 交付物清单
- 后端：FastAPI 服务、数据库初始化脚本、WebSocket 通道。
- 逻辑引擎：独立规则模块（可被后端调用）。
- 前端：Vue3 页面与状态管理、实时更新。
- 文档：`memory-bank/architecture.md` 与 `memory-bank/implementation-plan.md` 持续更新。

## 风险与待决
- 规则细节解释的边界情况（垫棋与大小判定）需结合 `XianQi_rules.md` 做明确实现决策。
- WebSocket 断线重连与状态恢复策略是否需要补充（MVP 可简化为重连后拉全量状态；服务端重启不恢复）。
